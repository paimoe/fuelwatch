<!DOCTYPE html>
<html>

<head>
    <title>Fuel App</title>
    <link rel="stylesheet" href="http://twitter.github.com/bootstrap/1.4.0/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="/static/fuel.css" />
</head>

<body>
<div id="wrap">

    <div class="content">
        <header class="row">
        {% block main %}
        <div class="span8 offset4">Perthfuel.com</div>
        {% endblock %}
        </header>
        
        {% block content %}
        {% endblock %}       
        
        <p>footer</p>
    </div>
    
    <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.6.4/jquery.min.js"></script>
    <script type="text/javascript" src="http://maps.googleapis.com/maps/api/js?sensor=false"></script>
    
    <script type="text/javascript">
    
    var Fuel = {
        position: ''
    };
    
    Fuel.map = function() {
        console.log(Fuel.position);
        var latlng = new google.maps.LatLng(Fuel.position.latitude, Fuel.position.longitude);
        console.log(latlng);
        var myOptions = {
            zoom: 13,
            center: latlng,
            mapTypeId: google.maps.MapTypeId.ROADMAP
        };
        console.log(myOptions);
        map_container = $('#dataset-map').get(0);
        var map = new google.maps.Map(map_container, myOptions);
        console.log(map);        
    }
        
    Fuel.callback = function(data) {
        if (data['result'] == "OK") {
            
            $('#dataset-table').load('/ajax/dataset', {'postcode': data['message']}, function(response, status, xhr) {
                // Now waits for pricing data, before loading le page
                suburb_used = xhr.getResponseHeader('X-Perthfuel-Suburb');
                $('h1').text(data['message']);
                $('#header-data p').text(suburb_used);
                
                // Generate map data
                Fuel.map();
            });
        }      
    }
    
    Fuel.getLocation = function() {
        
        // Fetch I guess
        $.getJSON('/fetch?coords=' + this.position_full, function(data) { Fuel.callback(data); });
    }
    
    Fuel.init = function() {
        
        // Detect if $ exists, otherwise internet is broken LIKE ALWAYS
        {% if not denyJS %}
        if (!navigator.geolocation) {
            document.write("Your browser doesn't support geolocation")
            return false;
        }
        
        g = navigator.geolocation.getCurrentPosition(function(p) {
            Fuel.position = p.coords
            Fuel.position_full = p.coords.latitude + ',' + p.coords.longitude
            Fuel.getLocation();
        });
        {% endif %}
        
        /*
        u = 'https://maps.googleapis.com/maps/api/geocode/json?latlng=' + this.position + '&sensor=false'
        u = 'http://maps.googleapis.com/maps/api/js?sensor=false'
        var latlng = new google.maps.LatLng(this.position.latitude, this.position.longitude)
        
        //data = $.getJSON(u, callback);
        */
        
    }
    
    if (typeof($) == "undefined") { alert("internetttt"); } else {
    
    $(document).ready(Fuel.init());
    
}
    </script>
    

</div>
</body>

</html>
